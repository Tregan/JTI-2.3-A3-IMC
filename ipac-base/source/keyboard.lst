GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 1


   1               		.file	"keyboard.c"
   2               		.arch atmega2561
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.text
  11               	.global	KbScan
  12               		.type	KbScan, @function
  13               	KbScan:
  14               	/* prologue: frame size=0 */
  15               	/* prologue end (size=0) */
  16 0000 A398      		cbi 52-0x20,3
  17               	/* #APP */
  18 0002 0000      		nop
  19 0004 0000      		nop
  20               	/* #NOAPP */
  21 0006 6FB1      		in r22,47-0x20
  22 0008 A39A      		sbi 52-0x20,3
  23 000a A498      		cbi 52-0x20,4
  24               	/* #APP */
  25 000c 0000      		nop
  26 000e 0000      		nop
  27               	/* #NOAPP */
  28 0010 4FB1      		in r20,47-0x20
  29 0012 A49A      		sbi 52-0x20,4
  30 0014 5B98      		cbi 43-0x20,3
  31               	/* #APP */
  32 0016 0000      		nop
  33 0018 0000      		nop
  34               	/* #NOAPP */
  35 001a 8FB1      		in r24,47-0x20
  36 001c 5B9A      		sbi 43-0x20,3
  37 001e 5A98      		cbi 43-0x20,2
  38               	/* #APP */
  39 0020 0000      		nop
  40 0022 0000      		nop
  41               	/* #NOAPP */
  42 0024 2FB1      		in r18,47-0x20
  43 0026 5A9A      		sbi 43-0x20,2
  44 0028 6295      		swap r22
  45 002a 6F70      		andi r22,0x0f
  46 002c 7727      		clr r23
  47 002e 407F      		andi r20,lo8(-16)
  48 0030 5527      		clr r21
  49 0032 642B      		or r22,r20
  50 0034 752B      		or r23,r21
  51 0036 807F      		andi r24,lo8(-16)
  52 0038 9927      		clr r25
  53 003a 34E0      		ldi r19,4
  54 003c 880F      	1:	lsl r24
  55 003e 991F      		rol r25
  56 0040 3A95      		dec r19
  57 0042 01F4      		brne 1b
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 2


  58 0044 682B      		or r22,r24
  59 0046 792B      		or r23,r25
  60 0048 207F      		andi r18,lo8(-16)
  61 004a 3327      		clr r19
  62 004c 322F      		mov r19,r18
  63 004e 2227      		clr r18
  64 0050 622B      		or r22,r18
  65 0052 732B      		or r23,r19
  66 0054 7093 0000 		sts (KeyFound)+1,r23
  67 0058 6093 0000 		sts KeyFound,r22
  68 005c 8FEF      		ldi r24,hi8(-65)
  69 005e 6F3B      		cpi r22,lo8(-65)
  70 0060 7807      		cpc r23,r24
  71 0062 01F4      		brne .+2
  72 0064 00C0      		rjmp .L9
  73 0066 8FEF      		ldi r24,hi8(-64)
  74 0068 603C      		cpi r22,lo8(-64)
  75 006a 7807      		cpc r23,r24
  76 006c 00F4      		brsh .L17
  77 006e 8BEF      		ldi r24,hi8(-1025)
  78 0070 6F3F      		cpi r22,lo8(-1025)
  79 0072 7807      		cpc r23,r24
  80 0074 01F4      		brne .+2
  81 0076 00C0      		rjmp .L5
  82 0078 8CEF      		ldi r24,hi8(-1024)
  83 007a 6030      		cpi r22,lo8(-1024)
  84 007c 7807      		cpc r23,r24
  85 007e 00F4      		brsh .L18
  86 0080 8FEE      		ldi r24,hi8(-4097)
  87 0082 6F3F      		cpi r22,lo8(-4097)
  88 0084 7807      		cpc r23,r24
  89 0086 01F4      		brne .+2
  90 0088 00C0      		rjmp .L3
  91 008a 6F5F      		subi r22,lo8(-2049)
  92 008c 774F      		sbci r23,hi8(-2049)
  93 008e 01F0      		breq .+2
  94 0090 00C0      		rjmp .L2
  95 0092 00C0      		rjmp .L4
  96               	.L18:
  97 0094 8EEF      		ldi r24,hi8(-257)
  98 0096 6F3F      		cpi r22,lo8(-257)
  99 0098 7807      		cpc r23,r24
 100 009a 01F4      		brne .+2
 101 009c 00C0      		rjmp .L7
 102 009e 8FEF      		ldi r24,hi8(-129)
 103 00a0 6F37      		cpi r22,lo8(-129)
 104 00a2 7807      		cpc r23,r24
 105 00a4 01F0      		breq .L8
 106 00a6 6F5F      		subi r22,lo8(-513)
 107 00a8 7D4F      		sbci r23,hi8(-513)
 108 00aa 01F0      		breq .+2
 109 00ac 00C0      		rjmp .L2
 110 00ae 00C0      		rjmp .L6
 111               	.L17:
 112 00b0 8FEF      		ldi r24,hi8(-9)
 113 00b2 673F      		cpi r22,lo8(-9)
 114 00b4 7807      		cpc r23,r24
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 3


 115 00b6 01F0      		breq .L13
 116 00b8 8FEF      		ldi r24,hi8(-8)
 117 00ba 683F      		cpi r22,lo8(-8)
 118 00bc 7807      		cpc r23,r24
 119 00be 00F4      		brsh .L19
 120 00c0 8FEF      		ldi r24,hi8(-33)
 121 00c2 6F3D      		cpi r22,lo8(-33)
 122 00c4 7807      		cpc r23,r24
 123 00c6 01F0      		breq .L11
 124 00c8 8FEF      		ldi r24,hi8(-17)
 125 00ca 6F3E      		cpi r22,lo8(-17)
 126 00cc 7807      		cpc r23,r24
 127 00ce 01F0      		breq .L12
 128 00d0 6F5C      		subi r22,lo8(-49)
 129 00d2 7F4F      		sbci r23,hi8(-49)
 130 00d4 01F4      		brne .L2
 131 00d6 00C0      		rjmp .L10
 132               	.L19:
 133 00d8 8FEF      		ldi r24,hi8(-3)
 134 00da 6D3F      		cpi r22,lo8(-3)
 135 00dc 7807      		cpc r23,r24
 136 00de 01F0      		breq .L15
 137 00e0 8FEF      		ldi r24,hi8(-2)
 138 00e2 6E3F      		cpi r22,lo8(-2)
 139 00e4 7807      		cpc r23,r24
 140 00e6 01F0      		breq .L16
 141 00e8 6B5F      		subi r22,lo8(-5)
 142 00ea 7F4F      		sbci r23,hi8(-5)
 143 00ec 01F4      		brne .L2
 144 00ee 81E0      		ldi r24,lo8(1)
 145 00f0 90E0      		ldi r25,hi8(1)
 146 00f2 00C0      		rjmp .L20
 147               	.L15:
 148 00f4 82E0      		ldi r24,lo8(2)
 149 00f6 90E0      		ldi r25,hi8(2)
 150 00f8 00C0      		rjmp .L20
 151               	.L8:
 152 00fa 83E0      		ldi r24,lo8(3)
 153 00fc 90E0      		ldi r25,hi8(3)
 154 00fe 00C0      		rjmp .L20
 155               	.L13:
 156 0100 84E0      		ldi r24,lo8(4)
 157 0102 90E0      		ldi r25,hi8(4)
 158 0104 00C0      		rjmp .L20
 159               	.L16:
 160 0106 85E0      		ldi r24,lo8(5)
 161 0108 90E0      		ldi r25,hi8(5)
 162 010a 00C0      		rjmp .L20
 163               	.L9:
 164 010c 86E0      		ldi r24,lo8(6)
 165 010e 90E0      		ldi r25,hi8(6)
 166 0110 00C0      		rjmp .L20
 167               	.L12:
 168 0112 87E0      		ldi r24,lo8(7)
 169 0114 90E0      		ldi r25,hi8(7)
 170 0116 00C0      		rjmp .L20
 171               	.L4:
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 4


 172 0118 88E0      		ldi r24,lo8(8)
 173 011a 90E0      		ldi r25,hi8(8)
 174 011c 00C0      		rjmp .L20
 175               	.L11:
 176 011e 89E0      		ldi r24,lo8(9)
 177 0120 90E0      		ldi r25,hi8(9)
 178 0122 00C0      		rjmp .L20
 179               	.L7:
 180 0124 8AE0      		ldi r24,lo8(10)
 181 0126 90E0      		ldi r25,hi8(10)
 182 0128 00C0      		rjmp .L20
 183               	.L5:
 184 012a 8BE0      		ldi r24,lo8(11)
 185 012c 90E0      		ldi r25,hi8(11)
 186 012e 00C0      		rjmp .L20
 187               	.L6:
 188 0130 8CE0      		ldi r24,lo8(12)
 189 0132 90E0      		ldi r25,hi8(12)
 190 0134 00C0      		rjmp .L20
 191               	.L3:
 192 0136 8DE0      		ldi r24,lo8(13)
 193 0138 90E0      		ldi r25,hi8(13)
 194 013a 00C0      		rjmp .L20
 195               	.L2:
 196 013c 88E8      		ldi r24,lo8(-120)
 197 013e 8093 0000 		sts KeyBuffer,r24
 198 0142 0895      		ret
 199               	.L22:
 200 0144 8FEF      		ldi r24,lo8(-1)
 201 0146 9FEF      		ldi r25,hi8(-1)
 202 0148 9093 0000 		sts (hKBEvent)+1,r25
 203 014c 8093 0000 		sts hKBEvent,r24
 204 0150 0895      		ret
 205               	.L26:
 206 0152 8FEF      		ldi r24,hi8(-1)
 207 0154 EF3F      		cpi r30,lo8(-1)
 208 0156 F807      		cpc r31,r24
 209 0158 01F0      		breq .L25
 210 015a 8481      		ldd r24,Z+4
 211 015c 9581      		ldd r25,Z+5
 212 015e 0196      		adiw r24,1
 213 0160 9583      		std Z+5,r25
 214 0162 8483      		std Z+4,r24
 215 0164 0895      		ret
 216               	.L10:
 217 0166 8EE0      		ldi r24,lo8(14)
 218 0168 90E0      		ldi r25,hi8(14)
 219               	.L20:
 220 016a 8093 0000 		sts KeyBuffer,r24
 221 016e E091 0000 		lds r30,hKBEvent
 222 0172 F091 0000 		lds r31,(hKBEvent)+1
 223 0176 3097      		sbiw r30,0
 224 0178 01F4      		brne .L26
 225 017a 00C0      		rjmp .L22
 226               	.L25:
 227 017c 0895      		ret
 228               	/* epilogue: frame size=0 */
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 5


 229               	/* epilogue: noreturn */
 230               	/* epilogue end (size=0) */
 231               	/* function KbScan size 203 (203) */
 232               		.size	KbScan, .-KbScan
 233               	.global	KbSetKeyRepeating
 234               		.type	KbSetKeyRepeating, @function
 235               	KbSetKeyRepeating:
 236               	/* prologue: frame size=0 */
 237               	/* prologue end (size=0) */
 238 017e E82F      		mov r30,r24
 239 0180 862F      		mov r24,r22
 240 0182 8150      		subi r24,lo8(-(-1))
 241 0184 8230      		cpi r24,lo8(2)
 242 0186 00F4      		brsh .L31
 243 0188 E031      		cpi r30,lo8(16)
 244 018a 00F4      		brsh .L31
 245 018c FF27      		clr r31
 246 018e E050      		subi r30,lo8(-(KeyRepeatArray))
 247 0190 F040      		sbci r31,hi8(-(KeyRepeatArray))
 248 0192 6083      		st Z,r22
 249               	.L31:
 250 0194 0895      		ret
 251               	/* epilogue: frame size=0 */
 252               	/* epilogue: noreturn */
 253               	/* epilogue end (size=0) */
 254               	/* function KbSetKeyRepeating size 12 (12) */
 255               		.size	KbSetKeyRepeating, .-KbSetKeyRepeating
 256               	.global	KbGetKey
 257               		.type	KbGetKey, @function
 258               	KbGetKey:
 259               	/* prologue: frame size=0 */
 260               	/* prologue end (size=0) */
 261 0196 8091 0000 		lds r24,KeyBuffer
 262 019a 9927      		clr r25
 263               	/* epilogue: frame size=0 */
 264 019c 0895      		ret
 265               	/* epilogue end (size=1) */
 266               	/* function KbGetKey size 4 (3) */
 267               		.size	KbGetKey, .-KbGetKey
 268               	.global	KbInjectKey
 269               		.type	KbInjectKey, @function
 270               	KbInjectKey:
 271               	/* prologue: frame size=0 */
 272               	/* prologue end (size=0) */
 273 019e 8093 0000 		sts KeyBuffer,r24
 274 01a2 E091 0000 		lds r30,hKBEvent
 275 01a6 F091 0000 		lds r31,(hKBEvent)+1
 276 01aa 3097      		sbiw r30,0
 277 01ac 01F4      		brne .L35
 278 01ae 8FEF      		ldi r24,lo8(-1)
 279 01b0 9FEF      		ldi r25,hi8(-1)
 280 01b2 9093 0000 		sts (hKBEvent)+1,r25
 281 01b6 8093 0000 		sts hKBEvent,r24
 282 01ba 0895      		ret
 283               	.L35:
 284 01bc 8FEF      		ldi r24,hi8(-1)
 285 01be EF3F      		cpi r30,lo8(-1)
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 6


 286 01c0 F807      		cpc r31,r24
 287 01c2 01F0      		breq .L39
 288 01c4 8481      		ldd r24,Z+4
 289 01c6 9581      		ldd r25,Z+5
 290 01c8 0196      		adiw r24,1
 291 01ca 9583      		std Z+5,r25
 292 01cc 8483      		std Z+4,r24
 293               	.L39:
 294 01ce 0895      		ret
 295               	/* epilogue: frame size=0 */
 296               	/* epilogue: noreturn */
 297               	/* epilogue end (size=0) */
 298               	/* function KbInjectKey size 25 (25) */
 299               		.size	KbInjectKey, .-KbInjectKey
 300               	.global	KbInit
 301               		.type	KbInit, @function
 302               	KbInit:
 303               	/* prologue: frame size=0 */
 304               	/* prologue end (size=0) */
 305 01d0 A39A      		sbi 52-0x20,3
 306 01d2 A49A      		sbi 52-0x20,4
 307 01d4 5B9A      		sbi 43-0x20,3
 308 01d6 5A9A      		sbi 43-0x20,2
 309 01d8 1092 0000 		sts KbState,__zero_reg__
 310 01dc 8FEF      		ldi r24,lo8(-1)
 311 01de 9FEF      		ldi r25,hi8(-1)
 312 01e0 9093 0000 		sts (KeyFound)+1,r25
 313 01e4 8093 0000 		sts KeyFound,r24
 314               	/* #APP */
 315 01e8 0FB6      		in  __tmp_reg__, __SREG__
 316 01ea F894      		cli
 317 01ec 0F92      		push __tmp_reg__
 318               		
 319               	/* #NOAPP */
 320 01ee 1092 0000 		sts (hKBEvent)+1,__zero_reg__
 321 01f2 1092 0000 		sts hKBEvent,__zero_reg__
 322               	/* #APP */
 323 01f6 0F90      		pop __tmp_reg__
 324 01f8 0FBE      		out __SREG__, __tmp_reg__
 325               		
 326               	/* #NOAPP */
 327 01fa 8FEF      		ldi r24,lo8(-1)
 328 01fc 8093 0000 		sts KeyBuffer,r24
 329 0200 E0E0      		ldi r30,lo8(KeyRepeatArray)
 330 0202 F0E0      		ldi r31,hi8(KeyRepeatArray)
 331 0204 82E0      		ldi r24,lo8(2)
 332               	.L41:
 333 0206 8193      		st Z+,r24
 334 0208 90E0      		ldi r25,hi8(KeyRepeatArray+16)
 335 020a E030      		cpi r30,lo8(KeyRepeatArray+16)
 336 020c F907      		cpc r31,r25
 337 020e 01F4      		brne .L41
 338 0210 1092 0000 		sts (HoldCounter)+1,__zero_reg__
 339 0214 1092 0000 		sts HoldCounter,__zero_reg__
 340               	/* epilogue: frame size=0 */
 341 0218 0895      		ret
 342               	/* epilogue end (size=1) */
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 7


 343               	/* function KbInit size 46 (45) */
 344               		.size	KbInit, .-KbInit
 345               	.global	KbWaitForKeyEvent
 346               		.type	KbWaitForKeyEvent, @function
 347               	KbWaitForKeyEvent:
 348               	/* prologue: frame size=0 */
 349               	/* prologue end (size=0) */
 350 021a AB01      		movw r20,r22
 351 021c BC01      		movw r22,r24
 352 021e 80E0      		ldi r24,lo8(hKBEvent)
 353 0220 90E0      		ldi r25,hi8(hKBEvent)
 354 0222 0E94 0000 		call NutEventWait
 355 0226 20E0      		ldi r18,lo8(0)
 356 0228 30E0      		ldi r19,hi8(0)
 357 022a 8F5F      		subi r24,lo8(-1)
 358 022c 9F4F      		sbci r25,hi8(-1)
 359 022e 01F4      		brne .L47
 360 0230 21E0      		ldi r18,lo8(1)
 361 0232 30E0      		ldi r19,hi8(1)
 362               	.L47:
 363 0234 C901      		movw r24,r18
 364               	/* epilogue: frame size=0 */
 365 0236 0895      		ret
 366               	/* epilogue end (size=1) */
 367               	/* function KbWaitForKeyEvent size 16 (15) */
 368               		.size	KbWaitForKeyEvent, .-KbWaitForKeyEvent
 369               		.lcomm hKBEvent,2
 370               		.lcomm KeyFound,2
 371               		.lcomm KeyBuffer,1
 372               		.lcomm HoldCounter,2
 373               		.lcomm KbState,1
 374               		.lcomm KeyRepeatArray,16
 375               	/* File "source/keyboard.c": code  306 = 0x0132 ( 303), prologues   0, epilogues   3 */
GAS LISTING C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 keyboard.c
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:3      *ABS*:0000003f __SREG__
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:4      *ABS*:0000003e __SP_H__
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:5      *ABS*:0000003d __SP_L__
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:6      *ABS*:00000000 __tmp_reg__
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:7      *ABS*:00000001 __zero_reg__
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:13     .text:00000000 KbScan
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:369    .bss:00000002 KeyFound
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:370    .bss:00000004 KeyBuffer
                             .bss:00000000 hKBEvent
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:235    .text:0000017e KbSetKeyRepeating
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:373    .bss:00000008 KeyRepeatArray
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:258    .text:00000196 KbGetKey
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:270    .text:0000019e KbInjectKey
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:302    .text:000001d0 KbInit
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:372    .bss:00000007 KbState
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:371    .bss:00000005 HoldCounter
C:\Users\Matthijs\AppData\Local\Temp/cce1ta0D.s:347    .text:0000021a KbWaitForKeyEvent

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
NutEventWait
